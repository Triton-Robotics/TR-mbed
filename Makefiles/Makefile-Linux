NUCLEO_PATH = /media/$(USER)/NOD_F446RE

infantry-build:
	cmake --build cmake-build-debug --target TR-Infantry -j $(nproc)

testbench-build:
	cmake --build cmake-build-debug --target TR-TestBench -j $(nproc)

hero-build:
	cmake --build cmake-build-debug --target TR-Hero -j $(nproc)

sentry-build:
	cmake --build cmake-build-debug --target TR-Sentry -j $(nproc)

infantry: infantry-build
	cp cmake-build-debug/robots/Infantry/TR-Infantry.bin $(NUCLEO_PATH)

testbench: testbench-build
	cp cmake-build-debug/robots/TestBench/TR-TestBench.bin $(NUCLEO_PATH)

hero: hero-build
	cp cmake-build-debug/robots/Hero/TR-Hero.bin $(NUCLEO_PATH)

sentry: sentry-build
	cp cmake-build-debug/robots/Sentry/TR-Sentry.bin $(NUCLEO_PATH)

infantry-pi: infantry-build
	scp cmake-build-debug/robots/Infantry/TR-Infantry.bin pi:$(NUCLEO_PATH)

testbench-pi: testbench-build
	scp cmake-build-debug/robots/TestBench/TR-TestBench.bin pi:$(NUCLEO_PATH)

hero-pi: hero-build
	scp cmake-build-debug/robots/Hero/TR-Hero.bin pi:$(NUCLEO_PATH)

sentry-pi: sentry-build
	scp cmake-build-debug/robots/Sentry/TR-Sentry.bin pi:$(NUCLEO_PATH)

# JLink
infantry-jlink: infantry-build
	JLinkExe -device STM32F446RE -if SWD -speed 4000 -CommanderScript ./JLink/flashInf.jlink

testbench-jlink: testbench-build
	JLinkExe -device STM32F446RE -if SWD -speed 4000 -CommanderScript ./JLink/flashTest.jlink

hero-jlink: hero-build
	JLinkExe -device STM32F446RE -if SWD -speed 180000 -CommanderScript ./JLink/flashHero.jlink

sentry-jlink: sentry-build
	JLinkExe -device STM32F446RE -if SWD -speed 4000 -CommanderScript ./JLink/flashSen.jlink

serial:
	powershell.exe /c mbed-tools sterm -b 115200

bind:
	cmd.exe /c usbipd attach --wsl --busid 2-2

mount:
	sudo mount E: /mnt/e