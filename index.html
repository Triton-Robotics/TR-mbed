<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TR-mbed: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TR-mbed
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TR-mbed Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p><div class="fragment"><div class="line">  __________                        __             __   __   ___   ____ ___  _____</div>
<div class="line"> /_  __/ __ \            ____ ___  / /_  ___  ____/ /  / /  |__ \ / __ \__ \|__  /</div>
<div class="line">  / / / /_/ /  ______   / __ `__ \/ __ \/ _ \/ __  /  / /   __/ // / / /_/ / /_ &lt; </div>
<div class="line"> / / / _, _/  /_____/  / / / / / / /_/ /  __/ /_/ /  / /   / __// /_/ / __/___/ / </div>
<div class="line">/_/ /_/ |_|           /_/ /_/ /_/_.___/\___/\__,_/  / /   /____/\____/____/____/  </div>
<div class="line">                                                   /_/                            </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md0"></a>
Prerequisites</h2>
<p>The following setup guide is written assuming Ubuntu. This setup guide is applicable to other operating systems, but may take additional setup (i.e. WSL for Windows, or HomeBrew for MacOS).</p>
<div class="fragment"><div class="line">sudo apt install                  \</div>
<div class="line">  build-essential                 \</div>
<div class="line">  cmake                           \</div>
<div class="line">  python3-dev                     \</div>
<div class="line">  python3-pip                     \</div>
<div class="line">  gcc-arm-none-eabi               \</div>
<div class="line">  libnewlib-arm-none-eabi         \</div>
<div class="line">  libstdc++-arm-none-eabi-newlib  \</div>
<div class="line">  openocd                         \</div>
<div class="line">  ninja-build</div>
</div><!-- fragment --><p>Use pip to install <code>mbed</code> and various dependencies: </p><div class="fragment"><div class="line">pip install   \</div>
<div class="line">  mbed-tools  \</div>
<div class="line">  prettytable \</div>
<div class="line">  future      \</div>
<div class="line">  jinja2      \</div>
<div class="line">  intelhex</div>
</div><!-- fragment --><p>In <code>~/.bashrc</code> (or <code>~/.bash_profile</code>), append the following to enable <code>mbed-tools</code> via command line: </p><div class="fragment"><div class="line">export PATH=&quot;${PATH}:/home/${USER}/.local/bin&quot;</div>
</div><!-- fragment --><p>Optional: Extra dependencies for compiling micro-ros: </p>
<h2><a class="anchor" id="autotoc_md1"></a>
@code{shell}</h2>
<p>pip install \ catkin_pkg \ lark-parser \ empy \ colcon-common-extensions </p>
<h2><a class="anchor" id="autotoc_md2"></a>
Setup</h2>
<ol type="1">
<li>Clone this repo: <div class="fragment"><div class="line">git clone https://github.com/Triton-Robotics/TR-mbed.git</div>
</div><!-- fragment --></li>
<li>Navigate to project root directory and initialize <code>mbed</code> project: <div class="fragment"><div class="line">cd TR-mbed &amp;&amp; mbed-tools deploy</div>
</div><!-- fragment --></li>
</ol>
<p><b>Optional: At this point, you may choose to diverge from the CLI setup guide and set up an IDE instead. Check out the setup instructions for /home/runner/work/TR-mbed/TR-mbed/.md/clion.md "CLion" or /home/runner/work/TR-mbed/TR-mbed/.md/vscode.md "VSCode".</b></p>
<ol type="1">
<li>Configure <code>CMake</code> project. This should only be done once per project, or after editing any <code>CMakeLists.txt</code>:</li>
</ol>
<div class="fragment"><div class="line">cmake -S . -B cmake_build/NUCLEO_F446RE/develop/GCC_ARM -GNinja</div>
</div><!-- fragment --><ol type="1">
<li>Build the desired target using your IDE or via CLI:</li>
</ol>
<div class="fragment"><div class="line">cmake --build cmake_build/NUCLEO_F446RE/develop/GCC_ARM --target TR-Sentry -j $(nproc)</div>
</div><!-- fragment --><p>Viable targets for build are: <code>TR-Engineer</code>, <code>TR-Infantry</code>, <code>TR-Sentry</code>, <code>TR-Hero</code>, and <code>TR-TestBench</code></p>
<ol type="1">
<li><p class="startli">Locate the generated executable:</p>
<p class="startli">eg. The built executable for Sentry will be present in <code>cmake_build/NUCLEO_F446RE/develop/GCC_ARM/robots/Sentry/TR_Sentry.elf</code></p>
</li>
<li>Flash the executable to the target device and open a serial terminal:<ol type="a">
<li>For flashing device in WSL, see the <a href="#appendix-wsl-steps">Appendix</a></li>
</ol>
</li>
</ol>
<div class="fragment"><div class="line">openocd -f board/st_nucleo_f4.cfg -c &quot;program cmake_build/NUCLEO_F446RE/develop/GCC_ARM/robots/Sentry/TR-Sentry.elf verify reset exit&quot;</div>
<div class="line"> </div>
<div class="line">mbed-tools sterm -b 115200</div>
</div><!-- fragment --><p>If OpenOCD fails with the error <code>Error: libusb_open() failed with LIBUSB_ERROR_ACCESS</code>, you may need to add a <code>udev</code> rule to allow OpenOCD to access the ST-Link programmer:</p>
<div class="fragment"><div class="line">cd /etc/udev/rules.d</div>
<div class="line"> </div>
<div class="line"># Download openocd udev rules</div>
<div class="line">sudo wget https://raw.githubusercontent.com/openocd-org/openocd/master/contrib/60-openocd.rules</div>
<div class="line"> </div>
<div class="line"># Reload udev rules</div>
<div class="line">sudo udevadm control --reload</div>
</div><!-- fragment --><hr  />
 <h2><a class="anchor" id="autotoc_md4"></a>
Appendix: WSL Steps</h2>
<p>Author: Michael Owens</p>
<p>Flashing is where WSL begins to diverge from normal Linux. We have to pass through the USB device to WSL and then make sure we have the right installer.</p><ol type="1">
<li>Follow <a href="https://learn.microsoft.com/en-us/windows/wsl/connect-usb#attach-a-usb-device">this guide</a> to install <code>usbipd-win</code></li>
<li>Start windows powershell / windows terminal (not cmd, don't be cringe) and try running <code>usbipd list</code>. The output should look something like this: <div class="fragment"><div class="line">PS C:\Users\legor&gt; usbipd list</div>
<div class="line">Connected:</div>
<div class="line">BUSID  VID:PID    DEVICE                                                        STATE</div>
<div class="line">2-3    0b05:19b6  USB Input Device                                              Not shared</div>
<div class="line">3-2    0483:374b  ST-Link Debug, USB Mass Storage Device, USB Serial Device...  Attached</div>
<div class="line">3-3    13d3:56eb  USB2.0 HD UVC WebCam, USB2.0 IR UVC WebCam, Camera DFU De...  Not shared</div>
<div class="line">4-1    0489:e0e2  MediaTek Bluetooth Adapter                                    Not shared</div>
</div><!-- fragment --></li>
<li>We can see here that the bus id of the st link programmer for the board is <code>3-2</code>, so we should run <code>usbipd wsl attach --busid 3-2</code> (replace the busid with yours)</li>
<li>Finally, open your WSL shell. Run <code>lsusb</code>, the output should look like this, and now we know WSL has the device connected. <div class="fragment"><div class="line">ubuntu@my-pc:~/TR-mbed6$ lsusb</div>
<div class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</div>
<div class="line">Bus 001 Device 003: ID 0483:374b STMicroelectronics ST-LINK/V2.1</div>
<div class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</div>
</div><!-- fragment --></li>
<li>Flash the board with OpenOCD:</li>
</ol>
<div class="fragment"><div class="line">sudo openocd -f board/st_nucleo_f4.cfg -c &quot;program cmake_build/NUCLEO_F446RE/develop/GCC_ARM/robots/Sentry/TR-Sentry.elf verify reset exit&quot;</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md5"></a>
autotoc_md5</h3>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
